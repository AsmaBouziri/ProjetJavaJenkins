FROM openjdk:11

# Installe Maven et les dépendances pour X11
RUN apt-get update && \
    apt-get install -y xvfb maven libxrender1 libxtst6 libxi6 libxext6 && \
    rm -rf /var/lib/apt/lists/*


# Crée le répertoire de travail
WORKDIR /app

# Copie le pom.xml et télécharge les dépendances
COPY pom.xml /app
RUN mvn dependency:copy-dependencies

# Copie les fichiers sources et le fichier JAR
COPY src /app/src
COPY target/test-jenkins-1.0-SNAPSHOT.jar /app/projetjavajenkins.jar

ENV DISPLAY =:0.0

# Lancez Xvfb en arrière-plan et exécutez votre application Java
ENTRYPOINT ["sh", "-c", "Xvfb :99 -screen 0 1024x768x24 & java -Djava.awt.headless=false -Djava.awt.display=:99 -cp projetjavajenkins.jar:dependency/* main.java.SeConnecter"]